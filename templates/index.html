<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ASL Real-Time Recognition</title>

    <style>
        body {
            margin: 0;
            font-family: "Segoe UI", Arial, sans-serif;
            background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
            color: #ffffff;
        }

        h1 {
            text-align: center;
            padding: 22px 0;
            margin: 0;
            font-weight: 600;
            letter-spacing: 1px;
        }

        .container {
            display: flex;
            justify-content: center;
            align-items: stretch;
            gap: 35px;
            padding: 30px;
            flex-wrap: wrap;
        }

        /* Camera Section */
        .camera-box {
            background: #0b0b0b;
            padding: 20px;
            border-radius: 14px;
            box-shadow: 0 0 25px rgba(0,255,153,0.25);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .video-wrapper {
            position: relative;
        }

        video {
            width: 520px;
            max-width: 100%;
            border-radius: 12px;
            border: 3px solid #00ff99;
            background: #000;
        }

        canvas.overlay {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
        }

        button {
            width: 100%;
            margin-top: 18px;
            padding: 14px;
            font-size: 18px;
            font-weight: 600;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            background: #00ff99;
            color: #000;
            transition: 0.3s;
        }

        button:hover {
            background: #00cc7a;
        }

        /* Prediction Panel */
        .panel {
            background: #0b0b0b;
            padding: 30px 25px;
            border-radius: 14px;
            width: 300px;
            box-shadow: 0 0 25px rgba(0,0,0,0.6);
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .panel h2 {
            margin-top: 0;
            color: #00ff99;
            text-align: center;
            margin-bottom: 15px;
        }

        .prediction {
            font-size: 72px;
            text-align: center;
            margin: 10px 0 20px;
            font-weight: bold;
        }

        .confidence-text {
            text-align: center;
            margin-bottom: 10px;
            font-size: 15px;
        }

        .bar-bg {
            background: #333;
            border-radius: 20px;
            overflow: hidden;
            height: 18px;
        }

        .bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #00ff99, #00ccff);
            transition: width 0.3s ease;
        }

        .footer-strip {
            margin-top: 20px;
            background: rgba(0,0,0,0.35);
            padding: 12px 0;
            text-align: center;
            font-size: 14px;
            letter-spacing: 0.5px;
            opacity: 0.85;
        }
    </style>
</head>
<body>

<h1>ASL Real-Time Recognition</h1>

<div class="container">

    <!-- Camera -->
    <div class="camera-box">
        <div class="video-wrapper">
            <video id="video" autoplay></video>
            <canvas id="overlay" class="overlay"></canvas>
        </div>
        <button onclick="startCamera()">Open Camera</button>
    </div>

    <!-- Prediction Panel -->
    <div class="panel">
        <h2>Prediction</h2>
        <div class="prediction" id="prediction">â€“</div>
        <div class="confidence-text" id="confidenceText">Confidence: 0%</div>
        <div class="bar-bg"><div class="bar" id="confidenceBar"></div></div>
    </div>

</div>

<div class="footer-strip">
    AI-powered American Sign Language Recognition
</div>

<!-- Hidden canvas for sending ROI -->
<canvas id="sendCanvas" width="32" height="32" style="display:none;"></canvas>

<script>
let video = document.getElementById("video");
let overlay = document.getElementById("overlay");
let overlayCtx = overlay.getContext("2d");
let sendCanvas = document.getElementById("sendCanvas");
let sendCtx = sendCanvas.getContext("2d");

// ROI coordinates (match Python version logically)
const ROI_X = 100;
const ROI_Y = 80;
const ROI_W = 300;
const ROI_H = 300;

function startCamera() {
    navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => {
            video.srcObject = stream;
            video.onloadedmetadata = () => {
                overlay.width = video.videoWidth;
                overlay.height = video.videoHeight;
                drawOverlay();
                setInterval(sendFrame, 400);
            };
        });
}

function drawOverlay() {
    overlayCtx.clearRect(0, 0, overlay.width, overlay.height);
    overlayCtx.strokeStyle = "#00ff99";
    overlayCtx.lineWidth = 3;
    overlayCtx.strokeRect(ROI_X, ROI_Y, ROI_W, ROI_H);
    requestAnimationFrame(drawOverlay);
}

function sendFrame() {
    sendCtx.drawImage(video, ROI_X, ROI_Y, ROI_W, ROI_H, 0, 0, 32, 32);
    let imageData = sendCanvas.toDataURL("image/jpeg");

    fetch("/predict", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ image: imageData })
    })
    .then(res => res.json())
    .then(data => {
        document.getElementById("prediction").innerText = data.prediction;
        let conf = Math.round(data.confidence * 100);
        document.getElementById("confidenceText").innerText = "Confidence: " + conf + "%";
        document.getElementById("confidenceBar").style.width = conf + "%";
    });
}
</script>

</body>
</html>
